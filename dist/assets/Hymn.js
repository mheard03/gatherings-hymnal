import{_ as e,o as t,c as s,a as i,n as o,p as n,j as a,b as l,u as d,t as r,F as h,r as c,w as m,d as _}from"./main.js";import{S as u}from"./Search.js";import{M as f,b,S as g,h as p,r as v,g as y,t as w,E as k,j as E,a as A,f as M,c as T,d as C,B as x,i as $}from"./base-component.js";import{H as L}from"./HymnsDbProgress.js";const H="",D={data:()=>({windowMetrics:{scrollTop:document.scrollingElement.scrollTop,contentHeight:document.scrollingElement.scrollHeight,height:window.innerHeight},observer:void 0,animateText:!1,expandMarkerVisible:!1}),emits:["click"],mounted(){this.observer=new IntersectionObserver((e=>{this.expandMarkerVisible=e[0].isIntersecting})),this.observer.observe(this.$refs.expandMarker),setTimeout((()=>this.animateText=!0),500)},unmounted(){this.observer&&this.observer.disconnect()},computed:{footerClass(){let e="";return this.animateText&&(e="animated "),e+=this.expandMarkerVisible?"":"hide-text",e}}},_withScopeId$2=e=>(n("data-v-8dafb89a"),e=e(),a(),e),N={id:"nav-bottom",class:"scaled"},B=_withScopeId$2((()=>i("div",{class:"fab-wrapper invisible"},[i("div",{class:"d-flex justify-content-center"},[i("button",{class:"btn btn-fill btn-lg"},"Â ")])],-1))),I={id:"expand-marker",ref:"expandMarker"},R={class:"d-flex justify-content-center"},S=void 0,V=void 0,j=[_withScopeId$2((()=>i("svg",{class:"icon"},[i("use",{href:"#hymnal"})],-1))),_withScopeId$2((()=>i("span",null,"Go to...",-1)))];function _sfc_render$2(e,n,a,l,d,r){return t(),s("nav",N,[B,i("div",I,null,512),i("div",{class:o(["fab-wrapper",r.footerClass]),ref:"fabFixed"},[i("div",R,[i("button",{class:"btn btn-fill btn-lg fab shadow",onClick:n[0]||(n[0]=t=>e.$emit("click"))},j)])],2)])}const F=e(D,[["render",_sfc_render$2],["__scopeId","data-v-8dafb89a"]]),O=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",z=".sticky-top";class ScrollBarHelper{constructor(){this._element=document.body}getWidth(){const e=document.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}hide(){const e=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,"paddingRight",(t=>t+e)),this._setElementAttributes(O,"paddingRight",(t=>t+e)),this._setElementAttributes(".sticky-top","marginRight",(t=>t-e))}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(e,t,s){const i=this.getWidth(),manipulationCallBack=e=>{if(e!==this._element&&window.innerWidth>e.clientWidth+i)return;this._saveInitialAttribute(e,t);const o=window.getComputedStyle(e)[t];e.style[t]=`${s(Number.parseFloat(o))}px`};this._applyManipulationCallback(e,manipulationCallBack)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,"paddingRight"),this._resetElementAttributes(O,"paddingRight"),this._resetElementAttributes(".sticky-top","marginRight")}_saveInitialAttribute(e,t){const s=e.style[t];s&&f.setDataAttribute(e,t,s)}_resetElementAttributes(e,t){const manipulationCallBack=e=>{const s=f.getDataAttribute(e,t);void 0===s?e.style.removeProperty(t):(f.removeDataAttribute(e,t),e.style[t]=s)};this._applyManipulationCallback(e,manipulationCallBack)}_applyManipulationCallback(e,t){b(e)?t(e):g.find(e,this._element).forEach(t)}isOverflowing(){return this.getWidth()>0}}const P={className:"modal-backdrop",isVisible:!0,isAnimated:!1,rootElement:"body",clickCallback:null},W={className:"string",isVisible:"boolean",isAnimated:"boolean",rootElement:"(element|string)",clickCallback:"(function|null)"},q="backdrop",G="fade",K="show",Y="mousedown.bs.backdrop";class Backdrop{constructor(e){this._config=this._getConfig(e),this._isAppended=!1,this._element=null}show(e){this._config.isVisible?(this._append(),this._config.isAnimated&&v(this._getElement()),this._getElement().classList.add("show"),this._emulateAnimation((()=>{p(e)}))):p(e)}hide(e){this._config.isVisible?(this._getElement().classList.remove("show"),this._emulateAnimation((()=>{this.dispose(),p(e)}))):p(e)}_getElement(){if(!this._element){const e=document.createElement("div");e.className=this._config.className,this._config.isAnimated&&e.classList.add("fade"),this._element=e}return this._element}_getConfig(e){return(e={...P,..."object"==typeof e?e:{}}).rootElement=y(e.rootElement),w(q,e,W),e}_append(){this._isAppended||(this._config.rootElement.append(this._getElement()),k.on(this._getElement(),Y,(()=>{p(this._config.clickCallback)})),this._isAppended=!0)}dispose(){this._isAppended&&(k.off(this._element,Y),this._element.remove(),this._isAppended=!1)}_emulateAnimation(e){E(e,this._getElement(),this._config.isAnimated)}}const Q={trapElement:null,autofocus:!0},U={trapElement:"element",autofocus:"boolean"},J="focustrap",X="bs.focustrap",Z=".bs.focustrap",ee="focusin.bs.focustrap",te="keydown.tab.bs.focustrap",se="Tab",ie="forward",oe="backward";class FocusTrap{constructor(e){this._config=this._getConfig(e),this._isActive=!1,this._lastTabNavDirection=null}activate(){const{trapElement:e,autofocus:t}=this._config;this._isActive||(t&&e.focus(),k.off(document,Z),k.on(document,ee,(e=>this._handleFocusin(e))),k.on(document,te,(e=>this._handleKeydown(e))),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,k.off(document,Z))}_handleFocusin(e){const{target:t}=e,{trapElement:s}=this._config;if(t===document||t===s||s.contains(t))return;const i=g.focusableChildren(s);0===i.length?s.focus():"backward"===this._lastTabNavDirection?i[i.length-1].focus():i[0].focus()}_handleKeydown(e){"Tab"===e.key&&(this._lastTabNavDirection=e.shiftKey?"backward":"forward")}_getConfig(e){return e={...Q,..."object"==typeof e?e:{}},w(J,e,U),e}}const enableDismissTrigger=(e,t="hide")=>{const s=`click.dismiss${e.EVENT_KEY}`,i=e.NAME;k.on(document,s,`[data-bs-dismiss="${i}"]`,(function(s){if(["A","AREA"].includes(this.tagName)&&s.preventDefault(),A(this))return;const o=M(this)||this.closest(`.${i}`),n=void 0;e.getOrCreateInstance(o)[t]()}))},ne="modal",ae="bs.modal",le=".bs.modal",de=".data-api",re="Escape",he={backdrop:!0,keyboard:!0,focus:!0},ce={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean"},me="hide.bs.modal",_e="hidePrevented.bs.modal",ue="hidden.bs.modal",fe="show.bs.modal",be="shown.bs.modal",ge="resize.bs.modal",pe="click.dismiss.bs.modal",ve="keydown.dismiss.bs.modal",ye="mouseup.dismiss.bs.modal",we="mousedown.dismiss.bs.modal",ke="click.bs.modal.data-api",Ee="modal-open",Ae="fade",Me="show",Te="modal-static",Ce=".modal.show",xe=".modal-dialog",$e=".modal-body",Le='[data-bs-toggle="modal"]';class Modal extends x{constructor(e,t){super(e),this._config=this._getConfig(t),this._dialog=g.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._ignoreBackdropClick=!1,this._isTransitioning=!1,this._scrollBar=new ScrollBarHelper}static get Default(){return he}static get NAME(){return ne}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){if(this._isShown||this._isTransitioning)return;const t=void 0;k.trigger(this._element,fe,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._isAnimated()&&(this._isTransitioning=!0),this._scrollBar.hide(),document.body.classList.add("modal-open"),this._adjustDialog(),this._setEscapeEvent(),this._setResizeEvent(),k.on(this._dialog,we,(()=>{k.one(this._element,ye,(e=>{e.target===this._element&&(this._ignoreBackdropClick=!0)}))})),this._showBackdrop((()=>this._showElement(e))))}hide(){if(!this._isShown||this._isTransitioning)return;const e=void 0;if(k.trigger(this._element,me).defaultPrevented)return;this._isShown=!1;const t=this._isAnimated();t&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),this._focustrap.deactivate(),this._element.classList.remove("show"),k.off(this._element,pe),k.off(this._dialog,we),this._queueCallback((()=>this._hideModal()),this._element,t)}dispose(){[window,this._dialog].forEach((e=>k.off(e,le))),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Backdrop({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new FocusTrap({trapElement:this._element})}_getConfig(e){return e={...he,...f.getDataAttributes(this._element),..."object"==typeof e?e:{}},w(ne,e,ce),e}_showElement(e){const t=this._isAnimated(),s=g.findOne(".modal-body",this._dialog);this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0,s&&(s.scrollTop=0),t&&v(this._element),this._element.classList.add("show");const transitionComplete=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,k.trigger(this._element,be,{relatedTarget:e})};this._queueCallback(transitionComplete,this._dialog,t)}_setEscapeEvent(){this._isShown?k.on(this._element,ve,(e=>{this._config.keyboard&&"Escape"===e.key?(e.preventDefault(),this.hide()):this._config.keyboard||"Escape"!==e.key||this._triggerBackdropTransition()})):k.off(this._element,ve)}_setResizeEvent(){this._isShown?k.on(window,ge,(()=>this._adjustDialog())):k.off(window,ge)}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide((()=>{document.body.classList.remove("modal-open"),this._resetAdjustments(),this._scrollBar.reset(),k.trigger(this._element,ue)}))}_showBackdrop(e){k.on(this._element,pe,(e=>{this._ignoreBackdropClick?this._ignoreBackdropClick=!1:e.target===e.currentTarget&&(!0===this._config.backdrop?this.hide():"static"===this._config.backdrop&&this._triggerBackdropTransition())})),this._backdrop.show(e)}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){const e=void 0;if(k.trigger(this._element,_e).defaultPrevented)return;const{classList:t,scrollHeight:s,style:i}=this._element,o=s>document.documentElement.clientHeight;!o&&"hidden"===i.overflowY||t.contains("modal-static")||(o||(i.overflowY="hidden"),t.add("modal-static"),this._queueCallback((()=>{t.remove("modal-static"),o||this._queueCallback((()=>{i.overflowY=""}),this._dialog)}),this._dialog),this._element.focus())}_adjustDialog(){const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._scrollBar.getWidth(),s=t>0;(!s&&e&&!$()||s&&!e&&$())&&(this._element.style.paddingLeft=`${t}px`),(s&&!e&&!$()||!s&&e&&$())&&(this._element.style.paddingRight=`${t}px`)}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(e,t){return this.each((function(){const s=Modal.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===s[e])throw new TypeError(`No method named "${e}"`);s[e](t)}}))}}k.on(document,ke,Le,(function(e){const t=M(this);["A","AREA"].includes(this.tagName)&&e.preventDefault(),k.one(t,fe,(e=>{e.defaultPrevented||k.one(t,ue,(()=>{T(this)&&this.focus()}))}));const s=g.findOne(".modal.show");s&&Modal.getInstance(s).hide();const i=void 0;Modal.getOrCreateInstance(t).toggle(this)})),enableDismissTrigger(Modal),C(Modal);const He="",De={components:{Fab:F,Search:u},data:()=>({bsModal:void 0,heading:"Go to...",isModalVisible:!1}),mounted(){this.bsModal=new Modal(this.$refs.goToModal),this.$refs.goToModal.addEventListener("shown.bs.modal",this.onModalShown),this.$refs.goToModal.addEventListener("hidden.bs.modal",this.onModalHidden),console.log("root",this.$root)},unmounted(){this.$refs.goToModal&&(this.$refs.goToModal.removeEventListener("shown.bs.modal",this.onModalShown),this.$refs.goToModal.removeEventListener("hidden.bs.modal",this.onModalHidden))},methods:{onFabClick(){this.bsModal.show()},onLabelChange(e){this.heading=e},async onModalShown(){this.$refs.search.value="",this.isModalVisible=!0,await this.$nextTick(),this.$refs.search.focus()},onModalHidden(){this.isModalVisible=!1}},watch:{$route(){this.bsModal.hide()}}},Ne=void 0,Be={class:"modal fade",id:"goToModal",ref:"goToModal",tabindex:"-1","aria-labelledby":"goToModalLabel","aria-hidden":"true"},Ie={class:"modal-dialog"},Re={class:"modal-content"},Se={class:"modal-header"},Ve={class:"modal-title",id:"goToModalLabel"},je=(e=>(n("data-v-6f41f41e"),e=e(),a(),e))((()=>i("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))),Fe={class:"modal-body pt-2"};function _sfc_render$1(e,o,n,a,m,_){const u=c("Fab"),f=c("Search");return t(),s(h,null,[l(u,{onClick:_.onFabClick,style:d({opacity:m.isModalVisible?0:1})},null,8,["onClick","style"]),i("div",Be,[i("div",Ie,[i("div",Re,[i("div",Se,[i("h5",Ve,r(m.heading),1),je]),i("div",Fe,[l(f,{ref:"search",onLabelChange:_.onLabelChange,onHeightChange:o[0]||(o[0]=t=>e.console.log("heightChange")),"hide-label":!0},null,8,["onLabelChange"])])])])],512)],64)}const Oe=void 0,ze="",Pe={components:{GoTo:e(De,[["render",_sfc_render$1],["__scopeId","data-v-6f41f41e"]]),HymnsDbProgress:L},props:{hymnalId:{required:!0},hymnNo:{required:!0},suffix:{required:!1}},data:()=>({fontResizeObserver:void 0,hymns:[]}),async mounted(){let e=-1;function onFontResize(){if(!this.$refs)return;let t=this.$refs.dummyVerses.map((e=>getComputedStyle(e,"::marker").width)).map((e=>parseFloat(e)));t=Math.max(...t,1),markerWidth?markerWidth!=e&&(e=markerWidth,root.style.setProperty("--verse-indent",newValue+"px")):root.style.removeProperty("--verse-indent")}this.fontResizeObserver=new ResizeObserver(onFontResize),this.loadHymns()},unmounted(){this.fontResizeObserver.disconnect()},methods:{async loadHymns(){if(this.hymns=await this.$hymnsDb.getHymns(this.hymnalId,parseInt(this.hymnNo)||1),await this.$nextTick(),(this.$refs.dummyVerses||[]).forEach((e=>this.fontResizeObserver.observe(e))),this.suffix||window.location.hash){let e=this.suffix||window.location.hash.replace("#","");if(e){let t=document.getElementById(e);t&&t.scrollIntoView({behavior:"instant"})}}}},watch:{hymnNo(){this.loadHymns()},hymnalId(){this.loadHymns()}}},We=void 0,qe={id:"primaryNav",class:"scaled navbar navbar-expand-lg"},Ge={class:"container"},Ke=void 0,Ye=[(e=>(n("data-v-f67c986e"),e=e(),a(),e))((()=>i("svg",{class:"icon"},[i("use",{href:"#back"})],-1)))],Qe={id:"hymnContainer",class:"container",ref:"hymnContainer"},Ue=["id"],Je={class:"mb-4"},Xe={class:"lines"},Ze=["innerHTML"];function _sfc_render(e,n,a,d,u,f){const b=c("HymnsDbProgress"),g=c("GoTo");return t(),s(h,null,[i("nav",qe,[i("div",Ge,[i("button",{class:"btn btn-ghost back",onClick:n[0]||(n[0]=t=>e.$router.backOrDefault())},Ye)])]),i("main",null,[i("div",Qe,[l(b,{progressProp:"hymns",loading:"Loading hymn..."},{default:m((()=>[(t(!0),s(h,null,_(u.hymns,(e=>(t(),s("section",{key:e.hymnId,id:e.suffix,class:o(e.special)},[i("h1",Je,r(e.title),1),i("div",Xe,[(t(!0),s(h,null,_(e.lines,(e=>(t(),s("p",{class:o(e.type),innerHTML:e.html},null,10,Ze)))),256)),i("p",{ref_for:!0,ref:"dummyVerses",class:"dummyVerse verse"},null,512)])],10,Ue)))),128))])),_:1})],512)]),l(g)],64)}const et=e(Pe,[["render",_sfc_render],["__scopeId","data-v-f67c986e"]]);export{et as default};
//# sourceMappingURL=Hymn.js.map
