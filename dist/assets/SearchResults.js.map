{"version":3,"file":"SearchResults.js","sources":["../../src/views/SearchResults.vue"],"sourcesContent":["<template>\r\n  <nav id=\"primaryNav\" class=\"scaled navbar navbar-expand-lg navbar-dark bg-primary\">\r\n    <div class=\"container flex-nowrap overflow-hidden\">\r\n      <button class=\"btn btn-fill back\" @click=\"$router.backOrDefault()\"><svg class=\"icon\"><use href=\"#back\" /></svg></button>\r\n      <a class=\"navbar-brand flex-fill me-2\">Search</a>\r\n      <!-- <button class=\"btn btn-fill\"><svg class=\"icon\"><use href=\"#text-options\" /></svg></button> -->\r\n    </div>\r\n  </nav>\r\n  <main>\r\n    <div class=\"top-block\">\r\n      <div class=\"container\">\r\n        <Search ref=\"searchForm\" initial-mode=\"keyword\" label-class=\"h1\" />\r\n      </div>\r\n    </div>\r\n    <div id=\"loading\" v-if=\"loading\">\r\n      <div class=\"spinner-border mb-2\"></div>\r\n      <span class=\"message fs-5\" role=\"status\">Searching...</span>\r\n    </div>\r\n    <div id=\"search-results\" class=\"container\" v-if=\"!loading && mode == 'keyword'\">\r\n      <p class=\"mb-3\">\r\n        <template v-if=\"pageCount > 1\">Page {{ page }} of</template>\r\n        {{ resultCount }} results\r\n      </p>\r\n      <template v-for=\"result of results\" :key=\"result.hymn.hymnId\">\r\n        <div class=\"result\" :class=\"'theme-' + result.hymn.hymnalId\">\r\n          <div class=\"hymnal-label scaled\"><span class=\"rounded\">{{ result.hymn.hymnal.title }} #{{result.hymn.hymnNoTxt}}</span></div>\r\n          <a class=\"result-link fs-5\" :href=\"result.hymn.url\" @click.stop.prevent=\"onResultClick(result.hymn)\"><span v-html=\"result.title\"></span></a>\r\n          <p class=\"result-preview\" v-if=\"result.preview\" v-html=\"result.preview\"></p>\r\n        </div>\r\n      </template>\r\n    </div>\r\n  </main>\r\n</template>\r\n\r\n<script>\r\nimport Search from '../components/Search.vue';\r\n\r\nexport default {\r\n  props: {\r\n    keywords: { type: String, required: false, default: \"\" },\r\n    page: { type: Number, required: false, default: 1 }\r\n  },\r\n  data() {\r\n    return {\r\n      mode: \"keyword\",\r\n      results: undefined,\r\n      resultCount: undefined,\r\n      pageCount: undefined,\r\n      loading: true\r\n    }\r\n  },\r\n  mounted() {\r\n    this.$refs.searchForm.value = this.keywords;\r\n    this.mode = this.$refs.searchForm.mode;\r\n    this.$watch(() => this.$refs.searchForm.mode, (v) => this.mode = v);\r\n  },\r\n  methods: {\r\n    async onResultClick(hymn) {\r\n      if (!hymn) return;\r\n      try {\r\n        let currentPath = this.$route.path;\r\n        let newKeyword = this.$refs.searchForm.value;\r\n        let currentPathNewKeyword = this.$router.resolve({ path: currentPath, query: { keywords: newKeyword.trim() }});\r\n        this.$router.replace(currentPathNewKeyword);\r\n      }\r\n      catch {}\r\n      \r\n      await this.$nextTick();\r\n      this.$router.push(hymn.url);\r\n    }\r\n  },\r\n  watch: {\r\n    $route: {\r\n      async handler(value) {\r\n        if (this.$route.name != \"search\") return;\r\n        let keywords = this.$route.query.keywords; // this.keywords || this.$route.query.keywords;\r\n        let page = this.$route.query.page; // this.page || this.$route.query.page;\r\n        this.loading = true;\r\n        this.results = await this.$hymnsDb.search(keywords, page);\r\n      },\r\n      immediate: true\r\n    },\r\n    results(newValue) {\r\n      [\"resultCount\", \"perPage\", \"pageCount\"].forEach(k => this[k] = newValue[k]);\r\n      this.$forceUpdate();\r\n      this.loading = false;\r\n    }\r\n  },\r\n  components: {\r\n    Search\r\n  }\r\n};\r\n</script>\r\n \r\n<style scoped lang=\"scss\">\r\n/* --- SearchResults.vue --- */\r\n\r\n.result {\r\n  padding-top: var(--spacer-1);\r\n  padding-bottom: calc(var(--spacer-2) - var(--line-height-extra-y-half));\r\n  margin-bottom: var(--spacer-4);\r\n  // border-left: var(--spacer-1) solid var(--ui-color);\r\n  // padding-left: var(--spacer-2);\r\n}\r\n\r\n.result-preview {\r\n  margin-bottom: 0;\r\n  display: -webkit-box;\r\n  -webkit-box-orient: vertical;\r\n  -webkit-line-clamp: 3;\r\n  overflow: hidden;\r\n}\r\n\r\n.chonk .hymnNo {\r\n  display: none;\r\n}\r\n\r\n#loading {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  min-height: calc(var(--font-size) * 12);\r\n  flex-direction: column;\r\n}\r\n\r\n</style>"],"names":["_sfc_main","props","keywords","type","String","required","default","page","Number","data","mode","results","resultCount","pageCount","loading","mounted","this","$refs","searchForm","value","$watch","v","methods","async","hymn","currentPath","$route","path","newKeyword","currentPathNewKeyword","$router","resolve","query","trim","replace","$nextTick","push","url","watch","name","$hymnsDb","search","immediate","newValue","forEach","k","$forceUpdate","components","Search","id","class","_hoisted_2","_createElementVNode","createBaseVNode","href","_hoisted_5","_withScopeId","_hoisted_6","_hoisted_7","role","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_1","onClick","_cache","$event","_ctx","backOrDefault","_createVNode","_component_Search","ref","$data","_openBlock","_createElementBlock","_hoisted_8","_hoisted_11","_hoisted_12","_Fragment","key","_toDisplayString","$props","_renderList","result","hymnId","hymnalId","hymnal","title","hymnNoTxt","_withModifiers","$options","onResultClick","innerHTML","preview"],"mappings":"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"}