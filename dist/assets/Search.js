import{_ as e,r as s,o as t,c as r,n as l,t as a,e as n,a as o,f as i,v as u,g as d,F as h,d as m,h as c,w as p,i as y,p as f,j as v,k as b,b as g}from"./main.js";const I="",w={data(){return{hideLabel:this.$parent.$props.hideLabel,label:"Go to song...",value:"",defaultFocusedHymnalId:this.$root.routeHymnalId,userFocusedHymnalId:"",hymnsProgress:this.$hymnsDb.progress.hymns,results:[]}},computed:{valueasnumber(){return parseInt(this.value)},hymnsState(){const e=this.$hymnsDb.STATES;return this.hymnsProgress.status===e.ERROR?"error":this.hymnsProgress.status===e.READY?"ready":"loading"},resultState(){return this.valueasnumber?this.results.length?"visible":"no-results":"blank"},focusedHymnalId(){return 0==this.results.length?"":this.results.find((e=>e.hymnalId==this.userFocusedHymnalId))?this.userFocusedHymnalId:this.results.find((e=>e.hymnalId==this.defaultFocusedHymnalId))?this.defaultFocusedHymnalId:this.results[0].hymnalId}},watch:{async valueasnumber(e){let s=e;this.results=!s||s<0?[]:await this.$hymnsDb.getHymns(s)},results(e,s){this.focusedHymnalId!=this.userFocusedHymnalId&&(this.userFocusedHymnalId="")}},methods:{onInput(){this.value=this.value.replaceAll(/[^\d]+/gi,"")},onKeyDown(e){if(["Enter","ArrowUp","ArrowDown"].indexOf(e.key)<0)return;e.preventDefault(),e.stopPropagation();let s=this.results.length;if(0==s)return;if("Enter"==e.key){let e=this.results.find((e=>e.hymnalId==this.focusedHymnalId));return void(e&&this.$router.push(e.url))}if(1==s)return void(this.userFocusedHymnalId=this.results[0].hymnal);let t=this.results.findIndex((e=>e.hymnalId==this.focusedHymnalId));for(t+="ArrowUp"==e.key?-1:1;t<0;)t+=s;t%=s,this.userFocusedHymnalId=this.results[t].hymnalId},getHymnClasses(e){console.log("getHymnClasses",this.focusedHymnalId);let s=[`theme-${e.hymnalId}`];return e.hymnalId==this.focusedHymnalId&&s.push("focus"),s}}},_withScopeId=e=>(f("data-v-4948e57c"),e=e(),v(),e),$={class:"form-group"},S={style:{position:"relative","min-height":"var(--input-height)"}},k={id:"songLookupResults",class:"dropdown-menu force-show",ref:"songLookupResults"},H={class:"dropdown-item disabled"},F=void 0,_=void 0,x=[_withScopeId((()=>o("div",{class:"spinner-border spinner-border-sm me-2"},null,-1))),_withScopeId((()=>o("span",{class:"message",role:"status"},"Loading hymns",-1)))],C={class:"dropdown-item disabled"},L={class:"dropdown-item disabled"},K={class:"hymnal-label scaled"};function _sfc_render$2(e,f,v,b,g,I){const w=s("router-link");return t(),r("div",$,[g.hideLabel?n("",!0):(t(),r("label",{key:0,for:"txtSongNumber",class:l(["form-label",this.$parent.$props.labelClass])},a(g.label),3)),o("div",S,[o("div",{id:"songLookup",class:"form-control d-flex flex-column flex-fill",style:{position:"absolute"},ref:"songLookup",onKeydown:f[2]||(f[2]=(...e)=>I.onKeyDown&&I.onKeyDown(...e))},[i(o("input",{id:"txtSongNumber",class:"form-control",type:"text",autocomplete:"off",placeholder:"Song number",inputmode:"decimal",ref:"txtSongNumber","onUpdate:modelValue":f[0]||(f[0]=e=>g.value=e),onInput:f[1]||(f[1]=(...e)=>I.onInput&&I.onInput(...e))},null,544),[[u,g.value]]),o("div",k,[i(o("a",H,x,512),[[d,"loading"===I.hymnsState&&""!=g.value]]),i(o("a",C,"Couldn't load hymns",512),[[d,"error"===I.hymnsState]]),"ready"==I.hymnsState?(t(),r(h,{key:0},[i(o("a",L,"No hymns found",512),[[d,"no-results"==I.resultState]]),(t(!0),r(h,null,m(g.results,(e=>(t(),c(w,{to:e.url,class:l(["dropdown-item",...I.getHymnClasses(e)])},{default:p((()=>[o("div",K,[o("span",null,a(e.hymnalId),1)]),y(" "+a(e.hymnNoTxt)+" - "+a(e.title),1)])),_:2},1032,["to","class"])))),256))],64)):n("",!0)],512)],544)])])}const D=void 0,N={props:{hideButton:{type:Boolean,required:!1,default:!1}},data(){return{input:void 0,label:"Keyword search",hideLabel:this.$parent.$props.hideLabel,value:""}},computed:{hasValue(){return!!this.value.trim()}},methods:{onSubmit(e){let s={name:"search",query:{keywords:this.value}};if("search"==this.$route.name)this.$router.replace(s);else{if(!this.value||!this.value.trim())return;this.$router.push(s)}}}},q={class:"form-group"};function _sfc_render$1(e,s,d,h,m,c){return t(),r("div",q,[m.hideLabel?n("",!0):(t(),r("label",{key:0,for:"txtKeywords",class:l(["form-label",this.$parent.$props.labelClass])},a(m.label),3)),o("form",{class:"input-group",onSubmit:s[1]||(s[1]=b(((...e)=>c.onSubmit&&c.onSubmit(...e)),["stop","prevent"]))},[i(o("input",{id:"txtKeywords",class:"form-control",type:"text",placeholder:"Song name or lyrics","onUpdate:modelValue":s[0]||(s[0]=e=>m.value=e)},null,512),[[u,m.value]]),d.hideButton?n("",!0):(t(),r("input",{key:0,type:"submit",class:l(["btn btn-fill",c.hasValue?"":"disabled"]),value:"Go"},null,2))],32)])}const A=void 0,M={emits:["input","labelChange","heightChange"],props:{hideLabel:{type:Boolean,required:!1,default:!1},labelClass:{type:String,required:!1,default:""},initialMode:{type:String,required:!1,default:"numeric"}},data(){return{mode:this.initialMode,activeField:{},label:void 0}},mounted(){this.setMode(this.mode)},methods:{setMode(e){"numeric"!=e&&"keyword"!=e&&(e=""),e=e||"numeric",this.activeField="keyword"==e?this.$refs.searchKeyword:this.$refs.searchNumeric,this.mode=e,this.$emit("labelChange",this.activeField.label)},focus(){this.activeField.$el.querySelector("input").focus()}},computed:{value:{get(){return this.activeField.value},set(e){this.activeField.value=e}}},components:{SearchNumeric:e(w,[["render",_sfc_render$2],["__scopeId","data-v-4948e57c"]]),SearchKeyword:e(N,[["render",_sfc_render$1]])},watch:{value(e){this.$emit("input",{mode:this.mode,value:e})},async mode(){await this.$nextTick(),this.focus()}}},R={class:"mt-2"},E=y("or "),B={class:"mt-2"},P=y("or ");function _sfc_render(e,l,a,n,u,m){const c=s("SearchNumeric"),p=s("SearchKeyword");return t(),r(h,null,[i(o("div",null,[g(c,{ref:"searchNumeric"},null,512),o("p",R,[E,o("a",{href:"#",onClick:l[0]||(l[0]=b((e=>m.setMode("keyword")),["stop","prevent"]))},"search by keyword")])],512),[[d,"numeric"==u.mode]]),i(o("div",null,[g(p,{ref:"searchKeyword"},null,512),o("p",B,[P,o("a",{href:"#",onClick:l[1]||(l[1]=b((e=>m.setMode("numeric")),["stop","prevent"]))},"enter a song number")])],512),[[d,"keyword"==u.mode]])],64)}const T=e(M,[["render",_sfc_render]]);export{T as S};
//# sourceMappingURL=Search.js.map
